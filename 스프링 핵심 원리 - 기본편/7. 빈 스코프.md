# ğŸ“Œ ëª©ì°¨
- ë¹ˆ ìŠ¤ì½”í”„ë€?
- í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„
- í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ - ì‹±ê¸€í†¤ ë¹ˆê³¼ í•¨ê»˜ ì‚¬ìš©ì‹œ ë¬¸ì œì 
- í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ - ì‹±ê¸€í†¤ ë¹ˆê³¼ í•¨ê»˜ ì‚¬ìš©ì‹œ Providerë¡œ ë¬¸ì œ í•´ê²°
- ì›¹ ìŠ¤ì½”í”„
- request ìŠ¤ì½”í”„ ì˜ˆì œ ë§Œë“¤ê¸°
- ìŠ¤ì½”í”„ì™€ Provider
- ìŠ¤ì½”í”„ì™€ í”„ë¡ì‹œ

# ğŸ’¡ ë¹ˆ ìŠ¤ì½”í”„ë€?
> ë¹ˆì´ ì¡´ì¬í•  ìˆ˜ ìˆëŠ” ë²”ìœ„

- ìŠ¤í”„ë§ ë¹ˆì€ ê¸°ë³¸ì ìœ¼ë¡œ ì‹±ê¸€í†¤ ìŠ¤ì½”í”„ë¡œ ìƒì„±ëœë‹¤. 
- ë¹ˆ ìŠ¤ì½”í”„ë¥¼ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ì‹œì‘ê³¼ í•¨ê»˜ ìƒì„±ë˜ì–´ì„œ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë  ë•Œê¹Œì§€ ìœ ì§€ëœë‹¤.
- ë¹ˆ ìŠ¤ì½”í”„ë¥¼ ì§€ì •í•˜ë©´ ë¹ˆì´ ìœ ì§€ë˜ëŠ” ë²”ìœ„ë¥¼ ì§€ì •í•  ìˆ˜ ìˆë‹¤.


### ìŠ¤í”„ë§ì´ ì§€ì›í•˜ëŠ” ìŠ¤ì½”í”„
- **ì‹±ê¸€í†¤**
	- ê¸°ë³¸ ìŠ¤ì½”í”„, ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ì‹œì‘ê³¼ ì¢…ë£Œê¹Œì§€ ìœ ì§€ë˜ëŠ” ê°€ì¥ ë„“ì€ ë²”ìœ„ì˜ ìŠ¤ì½”í”„
- **í”„ë¡œí† íƒ€ì…**
	- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì˜ ìƒì„±ê³¼ ì˜ì¡´ê´€ê³„ ì£¼ì…ê¹Œì§€ë§Œ ê´€ì—¬í•˜ê³  ë”ëŠ” ê´€ë¦¬í•˜ì§€ ì•ŠëŠ” ë§¤ìš° ì§§ì€ ë²”ìœ„ì˜ ìŠ¤ì½”í”„
- **ì›¹ ê´€ë ¨ ìŠ¤ì½”í”„**
	- **request**: ì›¹ ìš”ì²­ì´ ë“¤ì–´ì˜¤ê³  ë‚˜ê°ˆë•Œ ê¹Œì§€ ìœ ì§€ë˜ëŠ” ìŠ¤ì½”í”„
	- **session**: ì›¹ ì„¸ì…˜ì´ ìƒì„±ë˜ê³  ì¢…ë£Œë  ë•Œ ê¹Œì§€ ìœ ì§€ë˜ëŠ” ìŠ¤ì½”í”„
	- **application**: ì›¹ì˜ ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸ì™€ ê°™ì€ ë²”ìœ„ë¡œ ìœ ì§€ë˜ëŠ” ìŠ¤ì½”í”„

### ë¹ˆ ìŠ¤ì½”í”„ ì§€ì • ë°©ë²•
- ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ìë™ ë“±ë¡

``` java
@Scope("prototype")
@Component
public class HelloBean {}
```

- ìˆ˜ë™ ë“±ë¡

``` java
@Scope("prototype")
@Bean
PrototypeBean HelloBean() {
	return new HelloBean();
}
```



# ğŸ’¡ í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„
### ì‹±ê¸€í†¤ ë¹ˆ ìš”ì²­
![](Image/Pasted%20image%2020250105211119.png)
1. ìŠ¤í”„ë§ ë¹ˆì„ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­
2. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” **ë³¸ì¸ì´ ê´€ë¦¬í•˜ëŠ” ìŠ¤í”„ë§ ë¹ˆ**ì„ ë°˜í™˜
3. ì´í›„ ê°™ì€ ìš”ì²­ì´ ì™€ë„ **ê°™ì€ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ì˜ ìŠ¤í”„ë§ ë¹ˆì„ ë°˜í™˜**

``` java
public class SingleTonTest {

    @Test
    void singletonBeanFind() {
        AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(SingletonBean.class);

        SingletonBean singletonBean1 = ac.getBean(SingletonBean.class);
        SingletonBean singletonBean2 = ac.getBean(SingletonBean.class);
        System.out.println("singletonBean1 = " + singletonBean1);
        System.out.println("singletonBean2 = " + singletonBean2);
        assertThat(singletonBean1).isSameAs(singletonBean2);

		// destroy() ì‹¤í–‰ O
        ac.close();
    }

    @Scope("singleton")
    static class SingletonBean {
        @PostConstruct
        public void init() {
            System.out.println("SingletonBean.init");
        }

        @PreDestroy
        public void destroy() {
            System.out.println("SingletonBean.destroy");
        }
    }
}
```

### í”„ë¡œí† íƒ€ì… ë¹ˆ ìš”ì²­

![](Image/Pasted%20image%2020250105223558.png)
![](Image/Pasted%20image%2020250105223616.png)
1. ìŠ¤í”„ë§ ë¹ˆì„ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­
2. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” **ìš”ì²­ì´ ì˜¨ ì‹œì ì— í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í•˜ê³ , í•„ìš”í•œ ì˜ì¡´ê´€ê³„ ì£¼ì…(DI)**
3. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ìƒì„±í•œ í”„ë¡œí† íƒ€ì… ë¹ˆì„ í´ë¼ì´ì–¸íŠ¸ì— ë°˜í™˜
4. ì´í›„ ê°™ì€ ìš”ì²­ì´ ì˜¤ë©´ **í•­ìƒ ìš”ì²­ì´ ì˜¨ ì‹œì ì— ìƒˆë¡œìš´ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í•´ì„œ DIí•œ í›„ ë°˜í™˜**

``` java
public class PrototypeTest {

    @Test
    void prototypeBeanFind() {
        AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(PrototypeBean.class);

        System.out.println("find prototypeBean1");
        PrototypeBean prototypeBean1 = ac.getBean(PrototypeBean.class);

        System.out.println("find prototypeBean1");
        PrototypeBean prototypeBean2 = ac.getBean(PrototypeBean.class);

        System.out.println("prototypeBean1 = " + prototypeBean1);
        System.out.println("prototypeBean2 = " + prototypeBean2);
        assertThat(prototypeBean1).isNotSameAs(prototypeBean2);

		// destroy() ì‹¤í–‰ X
        ac.close();
    }

    @Scope("prototype")
    static class PrototypeBean {
        @PostConstruct
        public void init() {
            System.out.println("PrototypeBean.init");
        }

		// destroy() ì‹¤í–‰ X
        @PreDestroy
        public void destroy() {
            System.out.println("PrototypeBean.destroy");
        }
    }
}
```

### ì‹±ê¸€í†¤ ë¹ˆ vs í”„ë¡œí† íƒ€ì… ë¹ˆ
ë‘ ë¹ˆì˜ í•µì‹¬ì ì¸ ì°¨ì´ëŠ” **ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ìŠ¤í”„ë§ ë¹ˆì„ ê´€ë¦¬í•˜ëŠ”ì§€** ì´ë‹¤.
- **ì‹±ê¸€í†¤ ë¹ˆ**
	- **ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ì‹œì‘ê³¼ ë™ì‹œì— ìƒì„±**ë˜ì–´ **ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë  ë•Œê¹Œì§€ ìœ ì§€í•œë‹¤.(ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ì‹±ê¸€í†¤ ë¹ˆ ê´€ë¦¬ ì±…ì„ì§)**
- **í”„ë¡œí† íƒ€ì… ë¹ˆ**
	- **ë¹ˆ ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œë§ˆë‹¤ ìƒì„±**ë˜ì–´ ì˜ì¡´ê´€ê³„ ì£¼ì… ë° ì´ˆê¸°í™” í›„ í´ë¼ì´ì–¸íŠ¸ì— ë°˜í™˜í•œë‹¤.
	- ë°˜í•œ ì´í›„ **ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ìƒì„±ëœ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ê´€ë¦¬í•˜ì§€ ì•Šê³  í”„ë¡œí† íƒ€ì… ë¹ˆì„ ê´€ë¦¬í•  ì±…ì„ì€ í´ë¼ì´ì–¸íŠ¸**ì— ìˆë‹¤.
	- ê·¸ë˜ì„œ `@PreDestroy`ê°™ì€ ì¢…ë£Œ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤.
		- [@PreDestroy ì •ë¦¬](https://tojaman.tistory.com/164#3%EA%B0%80%EC%A7%80%20%EB%B9%88%20%EC%83%9D%EB%AA%85%EC%A3%BC%EA%B8%B0%20%EC%BD%9C%EB%B0%B1-1)

### í”„ë¡œí† íƒ€ì… ë¹ˆ íŠ¹ì§• ì •ë¦¬
- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­í•  ë•Œë§ˆë‹¤ ìƒˆë¡œ ìƒì„±ëœë‹¤.
- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì˜ ìƒì„±ê³¼ ì˜ì¡´ê´€ê³„ ì£¼ì… ê·¸ë¦¬ê³  ì´ˆê¸°í™”ê¹Œì§€ë§Œ ê´€ì—¬í•œë‹¤.
- ì¢…ë£Œ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤.
- í”„ë¡œí† íƒ€ì… ë¹ˆì€ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì¡°íšŒí•œ í´ë¼ì´ì–¸íŠ¸ê°€ ê´€ë¦¬í•´ì•¼ í•œë‹¤.
- ì¢…ë£Œ ë©”ì„œë“œì— ëŒ€í•œ í˜¸ì¶œë„ í´ë¼ì´ì–¸íŠ¸ê°€ ì§ì ‘ í•´ì•¼í•œë‹¤.

# ğŸ’¡ í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ - ì‹±ê¸€í†¤ ë¹ˆê³¼ í•¨ê»˜ ì‚¬ìš©ì‹œ ë¬¸ì œì 

### í”„ë¡œí† íƒ€ì… ë¹ˆ ì§ì ‘ ìš”ì²­
![](Image/Pasted%20image%2020250105231730.png)
1. í´ë¼ì´ì–¸íŠ¸ê°€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— í”„ë¡œë¡œíƒ€ì… ë¹ˆ ìš”ì²­
2. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í•´ì„œ ë°˜í™˜(í•´ë‹¹ ë¹ˆì˜ count í•„ë“œ ê°’ì€ 0)
3. í´ë¼ì´ì–¸íŠ¸ëŠ” ì¡°íšŒí•œ í”„ë¡œí† íƒ€ì… ë¹ˆì— `addCount()`ë¥¼ í˜¸ì¶œí•˜ì—¬ count í•„ë“œ += 1

- ê²°ê³¼ì ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ Aì™€ í´ë¼ì´ì–¸íŠ¸ B ê°ê° ê°œë³„ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ë°˜í™˜ ë°›ê³  ê° í”„ë¡œí† íƒ€ì… ë¹ˆì˜ count í•„ë“œì˜ ê°’ì€ 1ì´ëœë‹¤.

### ì‹±ê¸€í†¤ ë¹ˆì—ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆ ì‚¬ìš©
![](Image/Pasted%20image%2020250105232012.png)
- `clientBean`ì€ ì‹±ê¸€í†¤ì´ë¯€ë¡œ, ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ìƒì„± ì‹œì ì— í•¨ê³„ ìƒì„±ë˜ê³ , ì˜ì¡´ê´€ê³„ ì£¼ì… ë°œìƒ

1. `clientBean`ì€ ì˜ì¡´ê´€ê³„ ìë™ ì£¼ì… ì‚¬ìš©(ì£¼ì… ì‹œì ì— ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìš”ì²­)
2. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í•´ì„œ `clientBean`ì— ë°˜í™˜(í”„ë¡œí† íƒ€ì… ë¹ˆì˜ count í•„ë“œ ê°’ì¸ 0)

- ì´ì œ `clientBean`ì€ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ë‚´ë¶€ í•„ë“œì— ë³´ê´€í•œë‹¤.(ì •í™•íˆëŠ” ì°¸ì¡°ê°’ ë³´ê´€)

![](Image/%20image%2020250106003556.png)
3. í´ë¼ì´ì–¸íŠ¸ AëŠ” `clientBean`ì„ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­í•´ì„œ ë°›ìŒ
4. í´ë¼ì´ì–¸íŠ¸ AëŠ”  `clientBean.logic()`ì„ í˜¸ì¶œ
5. `clientBean`ì€ `prototypeBea`nì˜ `addCount()` ë¥¼ í˜¸ì¶œí•´ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆì˜ countë¥¼ ì¦ê°€(countê°’ = 1)

![](Image/%20image%2020250106003750.png)
6. í´ë¼ì´ì–¸íŠ¸ BëŠ”`clientBean`ì„ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­í•´ì„œ ë°›ìŒ
	- `clientBean`ì€ ì‹±ê¸€í†¤ ë¹ˆì´ë¯€ë¡œ í´ë¼ì´ì–¸íŠ¸ Aì™€ ê°™ì€ `clientBean` ë°›ìŒ
7. í´ë¼ì´ì–¸íŠ¸ BëŠ”  `clientBean.logic()`ì„ í˜¸ì¶œ
8. `clientBean` ì€ `prototypeBean`ì˜ `addCount()`ë¥¼ í˜¸ì¶œí•´ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆì˜ count ì¦ê°€
	- ì›ë˜ count ê°’ì´ 1ì´ì—ˆìœ¼ë¯€ë¡œ 2ê°€ ë¨
##### í—·ê°ˆë¦° ë¶€ë¶„
- Aì™€ Bê°€ ê°ê° `clientBean`ì„ ì´ ë‘ ë²ˆ í˜¸ì¶œí–ˆìœ¼ë¯€ë¡œ `clientBean`ì— ë‘ ê°œì˜ `prototypeBean`ì´ ì£¼ì…ë˜ì–´ì•¼ í•˜ëŠ” ê±° ì•„ë‹Œê°€?
	â†’ `prototypeBeaen`ì´ `final`ìœ¼ë¡œ ì„ ì–¸ëê¸° ë•Œë¬¸ì— `clientBean`ì— í•˜ë‚˜ì˜ `prototypeBean`ë§Œ ì¡´ì¬í•˜ëŠ” ê²ƒì´ë‹¤.

``` java
public class SingletonWithPrototupeTest1 {

    @Test
    void singletonClientUsePrototype() {
        AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(ClientBean.class, PrototypeBean.class);
        ClientBean clientBean1 = ac.getBean(ClientBean.class);
        int count1 = clientBean1.logic();
        assertThat(count1).isEqualTo(1);
        ClientBean clientBean2 = ac.getBean(ClientBean.class);
        int count2 = clientBean2.logic();
        assertThat(count2).isEqualTo(2);

        ac.close();
    }

    static class ClientBean {
        private final PrototypeBean prototypeBean;

        @Autowired
        public ClientBean(PrototypeBean prototypeBean) {
            this.prototypeBean = prototypeBean;
        }

        public int logic() {
            prototypeBean.addCount();
            int count = prototypeBean.getCount();
            return count;
        }
    }

    @Scope("prototype")
    static class PrototypeBean {
        private int count = 0;

        public void addCount() {
            count++;
        }

        public int getCount() {
            return count;
        }

        @PostConstruct
        public void init() {
            System.out.println("PrototypeBean.init " + this);
        }

        @PreDestroy
        public void destroy() {
            System.out.println("PrototypeBean.destroy");
        }
    }
}
```

##### í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì˜ë„ëŒ€ë¡œ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´?
ì´ë ‡ê²Œ í•˜ë©´ `ClientBean`ì„ í˜¸ì¶œí•  ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ `PrototypeBean`ì´ ìƒì„±ë˜ì–´ ì£¼ì…ëœë‹¤.
í•˜ì§€ë§Œ ì´ ë°©ì‹ì€ ì˜³ì§€ ì•Šì€ ë°©ì‹ì´ê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ ë°©ë²•ì„ ì´ìš©í•˜ì—¬ í•´ê²°í•œë‹¤.(ë‹¤ìŒ ì¥)

``` java
public class SingletonWithPrototupeTest1 {

    @Test
    void singletonClientUsePrototype() {
        AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(ClientBean.class, PrototypeBean.class);
        ClientBean clientBean1 = ac.getBean(ClientBean.class);
        int count1 = clientBean1.logic();
        assertThat(count1).isEqualTo(1);
        ClientBean clientBean2 = ac.getBean(ClientBean.class);
        int count2 = clientBean2.logic();
        assertThat(count2).isEqualTo(1);

        ac.close();
    }

    static class ClientBean {
//        private final PrototypeBean prototypeBean;

        @Autowired
        ApplicationContext applicationContext;

//        @Autowired
//        public ClientBean(PrototypeBean prototypeBean) {
//            this.prototypeBean = prototypeBean;
//        }

        public int logic() {
            PrototypeBean prototypeBean = applicationContext.getBean(PrototypeBean.class);
            prototypeBean.addCount();
            int count = prototypeBean.getCount();
            return count;
        }
    }

    @Scope("prototype")
    static class PrototypeBean {
        private int count = 0;

        public void addCount() {
            count++;
        }

        public int getCount() {
            return count;
        }

        @PostConstruct
        public void init() {
            System.out.println("PrototypeBean.init " + this);
        }

        @PreDestroy
        public void destroy() {
            System.out.println("PrototypeBean.destroy");
        }
    }
}
```

## ìš”ì•½ ì •ë¦¬
- `clientBean`ì€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ìƒì„±ë  ë•Œ í”„ë¡œí† íƒ€ì… ë¹ˆì„ í˜¸ì¶œí•´ì„œ ì˜ì¡´ê´€ê³„ ì£¼ì…(DI)ë°›ëŠ”ë‹¤.
- ì´í›„ í´ë¼ì´ì–¸íŠ¸ê°€ ì™€ì„œ `clientBean`ì„ í˜¸ì¶œí•˜ë©´ ê³¼ê±° ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ìƒì„±ë  ë•Œ ìƒì„±í•´ì„œ ì£¼ì… ë°›ì€ í”„ë¡œí† íƒ€ì… ë¹ˆì´ í¬í•¨ëœ ì‹±ê¸€í†¤ ë¹ˆì¸ `clientBean`ì„ ë°˜í™˜ ë°›ê²Œ ëœë‹¤.
- ì¦‰, **í´ë¼ì´ì–¸íŠ¸ë“¤ì€ ì´ë¯¸ ê³¼ê±°ì— ì£¼ì…ì´ ëë‚œ í”„ë¡œí† íƒ€ì… ë¹ˆì´ ì£¼ì…ëœ ì‹±ê¸€í†¤ ë¹ˆì¸ `clientBean`ì„ ë°›ê²Œ ë˜ëŠ” ê²ƒ**ì´ë‹¤.
	- í”„ë¡œí† íƒ€ì… ë¹ˆì€ í•„ìš”í•  ë•Œë§ˆë‹¤ ìƒì„±í•˜ê³  ì˜ì¡´ê´€ê³„ ì£¼ì… í›„ ë°˜í™˜ ë°›ì•„ì•¼ í•˜ëŠ”ë° ì´ ì›ì¹™ì´ ê¹¨ì§€ëŠ” ê²ƒì´ë‹¤.
# ğŸ’¡ í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ - ì‹±ê¸€í†¤ ë¹ˆê³¼ í•¨ê»˜ ì‚¬ìš©ì‹œ Providerë¡œ ë¬¸ì œ í•´ê²°
ì‹±ê¸€í†¤ ë¹ˆê³¼ í”„ë¡œí† íƒ€ì… ë¹ˆì„ í•¨ê»˜ ì‚¬ìš©í•  ë•Œ, ì‚¬ìš©í•  ë•Œë§ˆë‹¤ í•­ìƒ ìƒˆë¡œìš´ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í•  ìˆ˜ ìˆì„ê¹Œ?

### 1. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­
ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ìœ¼ë¡œ ì‹±ê¸€í†¤ ë¹ˆì´ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì‚¬ìš©í•  ë•Œë§ˆë‹¤ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìƒˆë¡œ ìš”ì²­í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤.

``` java
@Autowired
private ApplicationContext ac;

public int logic() {
	PrototypeBean prototypeBean = ac.getBean(PrototypeBean.class);
	prototypeBean.addCount();
	int count = prototypeBean.getCount();
	return count;
}
```

- `logic()` ë©”ì„œë“œë¥¼ ë³´ë©´ `ac.getBean()` ë©”ì„œë“œë¥¼ í†µí•´ì„œ í•­ìƒ ìƒˆë¡œìš´ í”„ë¡œí† íƒ€ì… ë¹ˆì´ ìƒì„±ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
- **ì˜ì¡´ê´€ê³„ë¥¼ ì™¸ë¶€ì—ì„œ ì£¼ì…(DI)ë°›ëŠ” ê²Œ ì•„ë‹ˆë¼ ì§ì ‘ í•„ìš”í•œ ì˜ì¡´ê´€ê³„ë¥¼ ì°¾ëŠ” ê²ƒ**ì„ **Dependency Lookup(DL)** ì˜ì¡´ê´€ê³„ ì¡°íšŒ(íƒìƒ‰)ì´ë¼ê³  í•œë‹¤.
- ê·¸ëŸ°ë° ì´ë ‡ê²Œ ìŠ¤í”„ë§ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ ì „ì²´ë¥¼ ì£¼ì…ë°›ê²Œ ë˜ë©´, ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ì¢…ì†ì ì¸ ì½”ë“œê°€ ë˜ê³ , ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë„ ì–´ë ¤ì›Œì§„ë‹¤
- ì§€ì •í•œ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì»¨í…Œì´ë„ˆì—ì„œ ëŒ€ì‹  ì°¾ì•„ì£¼ëŠ” DL ì •ë„ì˜ ê¸°ëŠ¥ë§Œ ìˆìœ¼ë©´ ë”±ì¸ë° ìŠ¤í”„ë§ì— ì´ëŸ¬í•œ ê¸°ëŠ¥ì´ ìˆë‹¤.

### 2. ObjectFactory, ObjectProvider
ì§€ì •í•œ ë¹ˆì„ ì»¨í…Œì´ë„ˆì—ì„œ ëŒ€ì‹  ì°¾ì•„ì£¼ëŠ” **DL ì„œë¹„ìŠ¤ë¥¼ ì œê³µ**í•˜ëŠ” ê²ƒì´ `ObjectProvider`ì´ë‹¤.
`ObjectFactory`ëŠ” ê³¼ê±°ì— ì‚¬ìš©í•˜ë˜ ì„œë¹„ìŠ¤ì´ê³  `ObjectFactory`ì— ì—¬ëŸ¬ í¸ì˜ ê¸°ëŠ¥ì„ ì¶”ê°€í•œ ê²ƒì´ `ObjectProvider`ì´ë‹¤.

##### ì˜ì¡´ê´€ê³„ ì£¼ì… ë°©ì‹(ac.getBean())

``` java
@Autowired
private ApplicationContext ac;

public int logic() {
	PrototypeBean prototypeBean = ac.getBean(PrototypeBean.class);
	prototypeBean.addCount();
	int count = prototypeBean.getCount();
	return count;
}
```

##### ObjectProvider ë°©ì‹

``` java
@Autowired
private ObjectProvider<PrototypeBean> prototypeBeanProvider;

public int logic() {
	PrototypeBean prototypeBean = prototypeBeanProvider.getObject();
	prototypeBean.addCount();
	int count = prototypeBean.getCount();
	return count;
}
```

- `ObjectProvider` ì˜ `getObject()` ë¥¼ í˜¸ì¶œí•˜ë©´ ë‚´ë¶€ì—ì„œëŠ” ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ í†µí•´ í•´ë‹¹ ë¹ˆì„ ì°¾ì•„ì„œ ë°˜í™˜ í•œë‹¤. (**DL**)
	- ë”°ë¡œ ì™¸ë¶€ì—ì„œ ì£¼ì…í•˜ëŠ” ì½”ë“œ ì—†ì´ `getObject()`ë§Œìœ¼ë¡œ í•„ìš”í•œ ì˜ì¡´ê´€ê³„ë¥¼ ì°¾ì•„ì„œ ì‚¬ìš©í•œë‹¤.
- ë”°ë¼ì„œ `prototypeBeanProvider.getObject()`ì„ í†µí•´ í•­ìƒ ìƒˆë¡œìš´ í”„ë¡œí† íƒ€ì… ë¹ˆì´ ìƒì„±ëœë‹¤.
- ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì§€ë§Œ, ê¸°ëŠ¥ì´ ë‹¨ìˆœí•˜ë¯€ë¡œ ë‹¨ìœ„í…ŒìŠ¤íŠ¸ë¥¼ ë§Œë“¤ê±°ë‚˜ mock ì½”ë“œë¥¼ ë§Œë“¤ê¸°ê°€ í›¨ì”¬ ì‰¬ì›Œì§„ë‹¤.

- **ObjectFactory**
	- ê¸°ëŠ¥ì´ ë‹¨ìˆœ, ë³„ë„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ í•„ìš” ì—†ìŒ, ìŠ¤í”„ë§ì— ì˜ì¡´
- **ObjectProvider**
	- ObjectFactory ìƒì†, ì˜µì…˜, ìŠ¤íŠ¸ë¦¼ ì²˜ë¦¬ë“± í¸ì˜ ê¸°ëŠ¥ì´ ë§ê³ , ë³„ë„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ í•„ìš” ì—†ìŒ, ìŠ¤í”„ë§ì— ì˜ì¡´

### 3. JSR-330 Provider
í•­ìƒ ìƒˆë¡œìš´ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í•˜ëŠ” ë§ˆì§€ë§‰ ë°©ë²•ìœ¼ë¡œ `jakarta.inject.Provider`ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤.
Gradleì— `jakarta.inject:jakarta.inject-api:2.0.1`ë¥¼ ì¶”ê°€í•˜ê³  ì‚¬ìš©í•œë‹¤.

``` java
@Autowired
private Provider<PrototypeBean> provider;

public int logic() {
	PrototypeBean prototypeBean = provider.get();
	prototypeBean.addCount();
	int count = prototypeBean.getCount();
	return count;
}
```

- `provider` ì˜ `get()` ì„ í˜¸ì¶œí•˜ë©´ ë‚´ë¶€ì—ì„œëŠ” ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ í†µí•´ í•´ë‹¹ ë¹ˆì„ ì°¾ì•„ì„œ ë°˜í™˜í•œë‹¤. (**DL**)
- ìë°” í‘œì¤€ì´ê³ , ê¸°ëŠ¥ì´ ë‹¨ìˆœí•˜ë¯€ë¡œ ë‹¨ìœ„í…ŒìŠ¤íŠ¸ë¥¼ ë§Œë“¤ê±°ë‚˜ mock ì½”ë“œë¥¼ ë§Œë“¤ê¸°ëŠ” í›¨ì”¬ ì‰¬ì›Œì§„ë‹¤.
- `Provider` ëŠ” ì§€ê¸ˆ ë”± í•„ìš”í•œ DL ì •ë„ì˜ ê¸°ëŠ¥ë§Œ ì œê³µí•œë‹¤

##### íŠ¹ì§•
- `get()` ë©”ì„œë“œ í•˜ë‚˜ë¡œ ê¸°ëŠ¥ì´ ë§¤ìš° ë‹¨ìˆœí•˜ë‹¤.
- ë³„ë„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”í•˜ë‹¤.
- ìë°” í‘œì¤€ì´ë¯€ë¡œ ìŠ¤í”„ë§ì´ ì•„ë‹Œ ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

### Provider ìµœì¢… ì •ë¦¬
- ë§¤ë²ˆ ì‚¬ìš©í•  ë•Œ ë§ˆë‹¤ ì˜ì¡´ê´€ê³„ ì£¼ì…ì´ ì™„ë£Œëœ ìƒˆë¡œìš´ ê°ì²´ê°€ í•„ìš”í•˜ë©´ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì‚¬ìš©í•œë‹¤.
- í•˜ì§€ë§Œ **ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ê°œë°œí•˜ëŠ” ì‹¤ë¬´ì—ì„œëŠ” ëŒ€ë¶€ë¶„ ì‹±ê¸€í†¤ìœ¼ë¡œ ëŒ€ë¶€ë¶„ì˜ ë¬¸ì œê°€ í•´ê²°ë˜ê¸° ë•Œë¬¸ì— í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì‚¬ìš©í•˜ëŠ” ì¼ì€ ë§¤ìš° ë“œë¬¼ë‹¤.**
- `ObjectProvider` , `JSR330 Provider` ë“±ì€ í”„ë¡œí† íƒ€ì… ë¿ë§Œ ì•„ë‹ˆë¼ DLì´ í•„ìš”í•œ ê²½ìš°ëŠ” ì–¸ì œë“ ì§€ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
##### ê·¸ëŸ¼ `ObjectProvider` , `JSR330 Provider` ì¤‘ ë­˜ ì‚¬ìš©í•´ì•¼ í• ê¹Œ?
- ìŠ¤í”„ë§ì´ ì•„ë‹Œ ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆì—ì„œë„ ì‚¬ìš©í•´ì•¼ í•œë‹¤ â†’ `JSR330 Provider`
- ìŠ¤í”„ë§ì—ì„œë§Œ ì‚¬ìš©í•œë‹¤ â†’ `ObjectProvider`
	- `ObjectProvider`ê°€ DLì„ ìœ„í•œ í¸ì˜ ê¸°ëŠ¥ì„ ë§ì´ ì œê³µí•´ì£¼ê³  ìŠ¤í”„ë§ ì™¸ì— ë³„ë„ ì˜ì¡´ê´€ê³„ ì¶”ê°€ê°€ í•„ìš” ì—†ê¸° ë•Œë¬¸ì— í¸ë¦¬í•˜ë‹¤.
# ğŸ’¡ ì›¹ ìŠ¤ì½”í”„
- ì›¹ ìŠ¤ì½”í”„ëŠ” ì›¹ í™˜ê²½ì—ì„œë§Œ ë™ì‘í•œë‹¤.
- í”„ë¡œí† íƒ€ì…ê³¼ ë‹¤ë¥´ê²Œ ìŠ¤í”„ë§ì´ í•´ë‹¹ ìŠ¤ì½”í”„ì˜ ì¢…ë£Œì‹œì ê¹Œì§€ ê´€ë¦¬í•œë‹¤.
	- ë”°ë¼ì„œ ì¢…ë£Œ ë©”ì„œë“œê°€ í˜¸ì¶œëœë‹¤.

### ì›¹ ìŠ¤ì½”í”„ ì¢…ë¥˜
- **request**
	- HTTP ìš”ì²­ í•˜ë‚˜ê°€ ë“¤ì–´ì˜¤ê³  ë‚˜ê°ˆ ë•Œ ê¹Œì§€ ìœ ì§€ë˜ëŠ” ìŠ¤ì½”í”„, ê°ê°ì˜ HTTP ìš”ì²­ë§ˆë‹¤ ë³„ë„ì˜ ë¹ˆ ì¸ìŠ¤í„´ ìŠ¤ê°€ ìƒì„±ë˜ê³ , ê´€ë¦¬ëœë‹¤.
- **session**
	- HTTP Sessionê³¼ ë™ì¼í•œ ìƒëª…ì£¼ê¸°ë¥¼ ê°€ì§€ëŠ” ìŠ¤ì½”í”„
- **application**
	- ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸( `ServletContext` )ì™€ ë™ì¼í•œ ìƒëª…ì£¼ê¸°ë¥¼ ê°€ì§€ëŠ” ìŠ¤ì½”í”„
- **websocket**
	- ì›¹ ì†Œì¼“ê³¼ ë™ì¼í•œ ìƒëª…ì£¼ê¸°ë¥¼ ê°€ì§€ëŠ” ìŠ¤ì½”í”„

### request ìŠ¤ì½”í”„ ë™ì‘ ë°©ì‹
request ìŠ¤ì½”í”„ ë™ì‘ ë°©ì‹ìœ¼ë¡œ ì„¤ëª…í•˜ì§€ë§Œ ë‚˜ë¨¸ì§€ ìŠ¤ì½”í”„ë„ ë™ì‘ ë°©ì‹ì€ ë¹„ìŠ·í•˜ë‹¤.

![](Image/Pasted%20image%2020250106004936.png)
# ğŸ’¡ request ìŠ¤ì½”í”„ ì˜ˆì œ ë§Œë“¤ê¸°

### ì›¹ í™˜ê²½ ì¶”ê°€
ì›¹ ìŠ¤ì½”í”„ëŠ” ì›¹ í™˜ê²½ì—ì„œë§Œ ë™ì‘í•˜ë¯€ë¡œ web í™˜ê²½ì´ ë™ì‘í•˜ë„ë¡ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€

- `build.gradle`ì— ì¶”ê°€
	- `implementation 'org.springframework.boot:spring-boot-starter-web'

### request ìŠ¤ì½”í”„ ì˜ˆì œ ê°œë°œ
ë™ì‹œì— ì—¬ëŸ¬ HTTP ìš”ì²­ì´ ì˜¤ë©´ ì •í™•íˆ ì–´ë–¤ ìš”ì²­ì´ ë‚¨ê¸´ ë¡œê·¸ì¸ì§€ êµ¬ë¶„í•˜ê¸° ì–´ë µë‹¤.
ì´ëŸ´ ë•Œ ì‚¬ìš©í•˜ê¸° ì¢‹ì€ ê²ƒì´ request ìŠ¤ì½”í”„ì´ë‹¤.

- ë‹¤ìŒê³¼ ê°™ì´ ë¡œê·¸ê°€ ë‚¨ë„ë¡ request ìŠ¤ì½”í”„ë¥¼ í™œìš©í•´ì„œ ì¶”ê°€ ê¸°ëŠ¥ì„ ê°œë°œí•´ë³´ì
```
[d06b992f...] request scope bean create
[d06b992f...][http://localhost:8080/log-demo] controller test
[d06b992f...][http://localhost:8080/log-demo] service id = testId
[d06b992f...] request scope bean close
```

##### MyLogger

``` java
@Component
@Scope(value = "request")
public class MyLogger {

    private String uuid;
    private String requestURL;

    public void setRequestURL(String requestURL) {
        this.requestURL = requestURL;
    }

    public void log(String message) {
        System.out.println("[" + uuid + "]" + "[" + requestURL + "] " + message);
    }

    @PostConstruct
    public void init() {
        uuid = UUID.randomUUID().toString();
        System.out.println("[" + uuid + "] request scope bean create:" + this);
    }

    @PreDestroy
    public void close() {
        System.out.println("[" + uuid + "] request scope bean close:" + this);
    }
}
```

- `@Scope(value = "request")`: request ìŠ¤ì½”í”„ë¡œ ì§€ì •í•œë‹¤.
	- `MyLogger`ë¹ˆì€ HTTP ìš”ì²­ ë‹¹ í•˜ë‚˜ì”© ìƒì„±
	- HTTP ìš”ì²­ì´ ëë‚˜ëŠ” ì‹œì ì— ì†Œë©¸
- `MyLogger`ë¹ˆì´ ìƒì„±ë˜ëŠ” ì‹œì ì—  `@PostConstruct` ì´ˆê¸°í™” ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ì„œ uuidë¥¼ ìƒì„±í•´ì„œ ì €ì¥í•œë‹¤.
- `MyLogger`ë¹ˆì´ ì†Œë©¸ë˜ëŠ” ì‹œì ì— `@PreDestroy` ë¥¼ ì‚¬ìš©í•´ì„œ ì¢…ë£Œ ë©”ì‹œì§€ ê¸°ë¡ëœë‹¤.
- `requestURL`ì€ ì´ ë¹ˆì´ ìƒì„±ë˜ëŠ” ì‹œì ì—ëŠ” ì•Œ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, ì™¸ë¶€ì—ì„œ setterë¡œ ì…ë ¥ ë°›ëŠ”ë‹¤.
##### LogDemoController, LogDemoService

``` java
@Controller
@RequiredArgsConstructor
public class LogDemoController {
    private final LogDemoService logDemoService;
    private final MyLogger myLogger;

    @RequestMapping("log-demo")
    @ResponseBody
    public String logDemo(HttpServletRequest request) {
        String requestURL = request.getRequestURL().toString();
        myLogger.setRequestURL(requestURL);
        myLogger.log("controller test");
        logDemoService.logic("testId");
        return "OK";
    }
}
```

- `requestURL`: `http://localhost:8080/log-demo`
	- ê° HTTP ìš”ì²­ì— ë”°ë¼ ìƒì„±ëœ `myLogger`ì— ì €ì¥
- ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ controller testë¼ëŠ” ë¡œê·¸ë¥¼ ë‚¨ê¸´ë‹¤
- ì„œë¹„ìŠ¤ì—ì„œë„ ë¡œê·¸ë¥¼ ë‚¨ê¸´ë‹¤.

``` java
@Service
@RequiredArgsConstructor
public class LogDemoService {
    private final MyLogger myLogger;

    public void logic(String id) {
        myLogger.log("service id = " + id);
    }
}
```

- **ë§Œì•½ request scopeë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  `logic()`ì— `requestURL` ë“±ì„ íŒŒë¼ë¯¸í„°ë¡œ ì´ ëª¨ë“  ì •ë³´ë¥¼ ì„œë¹„ìŠ¤ ê³„ì¸µì— ë„˜ê¸´ë‹¤ë©´ ì–´ë–»ê²Œ ë ê¹Œ?**
	- íŒŒë¼ë¯¸í„°ê°€ ë§ì•„ì„œ ì§€ì €ë¶„í•´ì§„ë‹¤.
	- ì›¹ê³¼ ê´€ë ¨ ì—†ëŠ” ì •ë³´ê°€ ì›¹ê³¼ ê´€ë ¨ ì—†ëŠ” ì„œë¹„ìŠ¤ ê³„ì¸µê¹Œì§€ ë„˜ì–´ê°„ë‹¤.
		- ì„œë¹„ìŠ¤ ê³„ì¸µì€ ì›¹ ê¸°ìˆ ì— ì¢…ì†ë˜ì§€ ì•Šê³ , ê°€ê¸‰ì  ìˆœìˆ˜í•˜ê²Œ ìœ ì§€í•˜ëŠ” ê²ƒì´ ìœ ì§€ë³´ìˆ˜ ê´€ì ì—ì„œ ì¢‹ë‹¤.
- ë”°ë¼ì„œ `@Scope(value = "request")`ë¥¼ ì‚¬ìš©í•˜ë©´ **ì›¹ê³¼ ê´€ë ¨ëœ ë¶€ë¶„ì„ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê¸°ì§€ ì•Šê³ , MyLoggerì˜ ë©¤ë²„ë³€ìˆ˜ì— ì €ì¥í•´ì„œ ì½”ë“œì™€ ê³„ì¸µì„ ê¹”ë”í•˜ê²Œ ìœ ì§€**í•  ìˆ˜ ìˆë‹¤

##### ì‹¤í–‰ ê²°ê³¼
- ê¸°ëŒ€í•˜ëŠ” ì¶œë ¥

```
[d06b992f...] request scope bean create
[d06b992f...][http://localhost:8080/log-demo] controller test
[d06b992f...][http://localhost:8080/log-demo] service id = testId
[d06b992f...] request scope bean close
```

- ì‹¤ì œ ì¶œë ¥ â†’ ì˜¤ë¥˜ ë°œìƒ

```
Error creating bean with name 'myLogger': Scope 'request' is not active for the current thread; consider defining a scoped proxy for this bean if you intend to refer to it from a singleton;
```

- ìŠ¤í”„ë§ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•˜ëŠ” ì‹œì ì— ì‹±ê¸€í†¤ ë¹ˆì€ ìƒì„±í•´ì„œ ì£¼ì…ì´ ê°€ëŠ¥í•˜ì§€ë§Œ, request ìŠ¤ì½”í”„ ë¹ˆì€ ì•„ì§ ìƒì„±ë˜ì§€ ì•ŠëŠ”ë‹¤. ì´ ë¹ˆì€ ì‹¤ì œ ê³ ê°ì˜ ìš”ì²­ì´ ì™€ì•¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.
- ì´ ë¬¸ì œëŠ” Providerë¥¼ ì´ìš©í•´ì„œ í•´ê²°í•´ë³´ì
# ğŸ’¡ ìŠ¤ì½”í”„ì™€ Provider
`ObjectProvider`ë¥¼ ì‚¬ìš©í•´ì„œ ìš”ì²­ì´ ì˜¤ë©´ ë¹ˆì„ ì°¾ì•„ì„œ ì‚¬ìš©í•˜ë„ë¡ í•´ë³´ì

``` java
@Controller
@RequiredArgsConstructor // ìƒì„±ì ì£¼ì…
public class LogDemoController {
    private final LogDemoService logDemoService;
    private final ObjectProvider<MyLogger> myLoggerProvider;

    @RequestMapping("log-demo")
    @ResponseBody
    public String logDemo(HttpServletRequest request) {
        String requestURL = request.getRequestURL().toString();

        MyLogger myLogger = myLoggerProvider.getObject();
        myLogger.setRequestURL(requestURL);
        myLogger.log("controller test");
        logDemoService.logic("testId");
        return "OK";
    }
}
```


``` java
@Service
@RequiredArgsConstructor
public class LogDemoService {
    private final ObjectProvider<MyLogger> myLoggerProvider;

    public void logic(String id) {
        MyLogger myLogger = myLoggerProvider.getObject();
        myLogger.log("service id = " + id);
    }
}
```

ì„œë²„ë¥¼ ì‹¤í–‰í•˜ê³  ë¸Œë¼ìš°ì €ì— `http://localhost:8080/log-demo`ë¥¼ ì…ë ¥í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ì‘ë™í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.
![](Image/Pasted%20image%2020250107214728.png)

- `ObjectProvider` ë•ë¶„ì— `ObjectProvider.getObject()` ë¥¼ í˜¸ì¶œí•˜ëŠ” ì‹œì ê¹Œì§€ request scope **ë¹ˆì˜ ìƒì„±ì„ ì§€ì—°**í•  ìˆ˜ ìˆë‹¤.(DL)
- `ObjectProvider.getObject()`ë¥¼ í˜¸ì¶œí•˜ì‹œëŠ” ì‹œì ì—ëŠ” HTTP ìš”ì²­ì´ ì§„í–‰ì¤‘ì´ë¯€ë¡œ request scope ë¹ˆ ì˜ ìƒì„±ì´ ì •ìƒ ì²˜ë¦¬ëœë‹¤.
- `ObjectProvider.getObject()`ë¥¼ `LogDemoController` , `LogDemoService`ì—ì„œ ê°ê° í•œë²ˆì”© ë”°ë¡œ í˜¸ì¶œí•´ë„ ê°™ì€ HTTP ìš”ì²­ì´ë©´ ê°™ì€ ìŠ¤í”„ë§ ë¹ˆì´ ë°˜í™˜ëœë‹¤.

# ğŸ’¡ ìŠ¤ì½”í”„ì™€ í”„ë¡ì‹œ
`ObjectProvider`ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ë„ ì¶©ë¶„í•˜ì§€ë§Œ ì½”ë“œë¥¼ ë” ê°„ê²°í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆëŠ” ë°©ì‹ì´ ë°”ë¡œ í”„ë¡ì‹œ ë°©ì‹ì´ë‹¤.
ìš°ì„  ë™ì‘ ì›ë¦¬ë¥¼ ì•Œì•„ë³´ì.

### ì›¹ ìŠ¤ì½”í”„ì™€ í”„ë¡ì‹œ ë™ì‘ ì›ë¦¬
![](Image/%20image%2020250106011651.png)
- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ì§„ì§œ `MyLoggerProxy`ë¹ˆì´ ì•„ë‹Œ í”„ë¡ì‹œ ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ë¥¼ ë¹ˆìœ¼ë¡œ ì£¼ì…í•œë‹¤.
- ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ëŠ” ìš”ì²­ì´ ì˜¤ë©´ ê·¸ë•Œ ë‚´ë¶€ì—ì„œ ì§„ì§œ ë¹ˆì„ ìš”ì²­í•˜ëŠ” ìœ„ì„ ë¡œì§ì´ ë“¤ì–´ê°€ ìˆì–´ì„œ ìš”ì²­ì´ ì˜¤ë©´ ê·¸ë•Œ ì§„ì§œ ë¹ˆì„ ìƒì„±í•œë‹¤.
- **í”„ë¡ì‹œ ê°ì²´ ë©”ì„œë“œ ì‹¤í–‰ ì‹œ
	1. í´ë¼ì´ì–¸íŠ¸ê°€ ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ì˜ ë©”ì„œë“œì¸ `Mylogger.log()`ë¥¼ í˜¸ì¶œ
	2. ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ëŠ” request ìŠ¤ì½”í”„ì˜ ì§„ì§œ `Mylogger.log()`ë¥¼ í˜¸ì¶œ
- ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ëŠ” ì›ë³¸ í´ë˜ìŠ¤ë¥¼ ìƒì† ë°›ì•„ì„œ ë§Œë“¤ì–´ì¡Œê¸° ë•Œë¬¸ì— ì´ ê°ì²´ë¥¼ ì‚¬ìš©í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ ì…ì¥ì—ì„œëŠ” ì‚¬ì‹¤ ì›ë³¸ì¸ì§€ ì•„ë‹Œì§€ë„ ëª¨ë¥´ê²Œ, ë™ì¼í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤(ë‹¤í˜•ì„±)

### ì½”ë“œ
- `proxyMode = ScopedProxyMode.TARGET_CLASS` ì¶”ê°€
	- ì ìš© ëŒ€ìƒì´ ì¸í„°í˜ì´ìŠ¤ê°€ ì•„ë‹Œ í´ë˜ìŠ¤ë©´ `TARGET_CLASS` ë¥¼ ì„ íƒ
	- ì ìš© ëŒ€ìƒì´ ì¸í„°í˜ì´ìŠ¤ë©´ `INTERFACES` ë¥¼ ì„ íƒ
- MyLoggerì˜ ê°€ì§œ í”„ë¡ì‹œ í´ë˜ìŠ¤ ë§Œë“¤ì–´ë‘ê³  HTTP requestì™€ ìƒê´€ ì—†ì´ ê°€ì§œ í”„ë¡ì‹œ í´ë˜ìŠ¤ë¥¼ ë‹¤ë¥¸ ë¹ˆì— ë¯¸ë¦¬ ì£¼ì…
- 

``` java
@Component
@Scope(value = "request", proxyMode = ScopedProxyMode.TARGET_CLASS)
public class MyLogger {
```

- `System.out.println("myLogger = " + myLogger.getClass());`
	- ì¶œë ¥ ê²°ê³¼
		- `myLogger = class hello.core.common.MyLogger$$EnhancerBySpringCGLIB$$b68b726d`
	- MyLogger ì§„ì§œ ê°ì²´ê°€ ì•„ë‹Œ CGLIBë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ë‚´ í´ë˜ìŠ¤ë¥¼ ìƒì† ë°›ì€ ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ê°€ ì¶œë ¥ëœë‹¤.
		- `MyLogger`ê°€ ì•„ë‹Œ `MyLogger$$EnhancerBySpringCGLIB$$b68b726d`ê°€ ì¶œë ¥ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

``` java
@Controller
@RequiredArgsConstructor // ìƒì„±ì ì£¼ì…
public class LogDemoController {
    private final LogDemoService logDemoService;
    private final MyLogger myLogger;

    @RequestMapping("log-demo")
    @ResponseBody
    public String logDemo(HttpServletRequest request) {

        String requestURL = request.getRequestURL().toString();
        
		// ì¶œë ¥ ê²°ê³¼
		// myLogger = class hello.core.common.MyLogger$$EnhancerBySpringCGLIB$$b68b726d
        System.out.println("myLogger = " + myLogger.getClass());
        myLogger.setRequestURL(requestURL);
        myLogger.log("controller test");
        logDemoService.logic("testId");
        return "OK";
    }
}
```

``` java
@Service
@RequiredArgsConstructor
public class LogDemoService {
    private final MyLogger myLogger;

    public void logic(String id) {
        myLogger.log("service id = " + id);
    }
}
```

##### ë™ì‘ ì •ë¦¬
- CGLIBë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ë‚´ í´ë˜ìŠ¤ë¥¼ ìƒì† ë°›ì€ ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ ì£¼ì…í•œë‹¤.
- ì´ ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ëŠ” ì‹¤ì œ ìš”ì²­ì´ ì˜¤ë©´ ê·¸ë•Œ ë‚´ë¶€ì—ì„œ ì‹¤ì œ ë¹ˆì„ ìš”ì²­í•˜ëŠ” ìœ„ì„ ë¡œì§ì´ ë“¤ì–´ìˆë‹¤.
- ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ëŠ” ì‹¤ì œ request scopeì™€ëŠ” ê´€ê³„ê°€ ì—†ë‹¤. ê·¸ëƒ¥ ê°€ì§œì´ê³ , ë‚´ë¶€ì— ë‹¨ìˆœí•œ ìœ„ì„ ë¡œì§ë§Œ ìˆê³ , ì‹±ê¸€í†¤ì²˜ëŸ¼ ë™ì‘í•œë‹¤

##### íŠ¹ì§• ì •ë¦¬
- í”„ë¡ì‹œ ê°ì²´ ë•ë¶„ì— í´ë¼ì´ì–¸íŠ¸ëŠ” ë§ˆì¹˜ ì‹±ê¸€í†¤ ë¹ˆì„ ì‚¬ìš©í•˜ë“¯ì´ í¸ë¦¬í•˜ê²Œ request scopeë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- ì‚¬ì‹¤ Providerë¥¼ ì‚¬ìš©í•˜ë“ , í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•˜ë“  í•µì‹¬ ì•„ì´ë””ì–´ëŠ” ì§„ì§œ ê°ì²´ ì¡°íšŒë¥¼ ê¼­ í•„ìš”í•œ ì‹œì ê¹Œì§€ ì§€ì—° ì²˜ë¦¬ í•œë‹¤ëŠ” ì ì´ë‹¤.
- ë‹¨ì§€ ì• ë…¸í…Œì´ì…˜ ì„¤ì • ë³€ê²½ë§Œìœ¼ë¡œ ì›ë³¸ ê°ì²´ë¥¼ í”„ë¡ì‹œ ê°ì²´ë¡œ ëŒ€ì²´í•  ìˆ˜ ìˆë‹¤.
- ì´ê²ƒì´ ë°”ë¡œ ë‹¤í˜•ì„±ê³¼ DI ì»¨í…Œì´ë„ˆ ê°€ ê°€ì§„ í° ê°•ì ì´ë‹¤.
- ê¼­ ì›¹ ìŠ¤ì½”í”„ê°€ ì•„ë‹ˆì–´ë„ í”„ë¡ì‹œëŠ” ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤

##### ì£¼ì˜ì 
- ë§ˆì¹˜ ì‹±ê¸€í†¤ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒ ê°™ì§€ë§Œ ë‹¤ë¥´ê²Œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— ê²°êµ­ ì£¼ì˜í•´ì„œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
- ì´ëŸ° íŠ¹ë³„í•œ scopeëŠ” ê¼­ í•„ìš”í•œ ê³³ì—ë§Œ ìµœì†Œí™”í•´ì„œ ì‚¬ìš©í•˜ì, ë¬´ë¶„ë³„í•˜ê²Œ ì‚¬ìš©í•˜ë©´ ìœ ì§€ë³´ìˆ˜í•˜ê¸° ì–´ë ¤ì›Œì§„ë‹¤.

